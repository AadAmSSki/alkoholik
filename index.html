<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karta Anonimowego Alkoholika</title>
<link rel="manifest" href="manifest.json">
<style>
body{font-family:Arial, sans-serif;background:#fff;margin:0;padding:20px;text-align:center;}
.card{width:360px;margin:20px auto;background:white;border-radius:18px;box-shadow:0 10px 20px rgba(0,0,0,0.3);padding:12px;color:black;display:none;}
.top{display:flex;}
.leftColumn{display:flex;flex-direction:column;align-items:center;margin-right:10px;}
.leftColumn img{width:100px;height:120px;object-fit:cover;border-radius:10px;border:2px solid #000;}
.flag{width:100px;height:60px;margin-top:8px;background:linear-gradient(to bottom, white 50%, red 50%);border:1px solid #000;border-radius:5px;}
.data{text-align:left;flex:1;}
.value{font-weight:bold;margin-bottom:2px;}
.label{font-size:12px;margin-bottom:6px;}
.buttons{display:flex;gap:6px;margin-top:10px;}
button{flex:1;padding:8px;border:none;border-radius:10px;background:#333;color:white;font-weight:bold;cursor:pointer;}
#moreData,#alkomatBox{display:none;background:#f0f0f0;padding:8px;border-radius:8px;margin-top:8px;max-height:140px;overflow:auto;}
.bottomBar{margin-top:10px;background:black;color:limegreen;padding:7px;border-radius:0 0 18px 18px;font-weight:bold;}
#generator input{margin:4px;padding:6px;width:90%;}
</style>
</head>
<body>

<h2 style="color:black;">KARTA ANONIMOWEGO ALKOHOLIKA</h2>

<div id="generator">
<input type="file" id="photoFile"><br>
<input type="text" id="photoURL" placeholder="Link do zdjƒôcia (do linku)"><br>

<input type="text" id="name" placeholder="Imiƒô / pseudonim"><br>
<input type="number" id="age" placeholder="Wiek"><br>
<input type="text" id="city" placeholder="Miasto"><br>
<input type="text" id="coupon" placeholder="Kod kuponu"><br>
<input type="number" id="shots" placeholder="Ilo≈õƒá wypitych ma≈Çpek"><br>
<input type="number" id="homelessNumber" placeholder="Numer menela"><br>
<input type="number" id="renta" placeholder="Renta (PLN)"><br>

<button onclick="randomData()">Losowe dane</button>
<button onclick="generateCard()">Generuj kartƒô</button>
<button onclick="copyLink()">Kopiuj link karty</button>
</div>

<div id="card" class="card">
<div class="top">
<div class="leftColumn">
<img id="cardPhoto">
<div class="flag"></div>
</div>
<div class="data">
<div class="value" id="cardName"></div><div class="label">Imiƒô / pseudonim</div>
<div class="value" id="cardAge"></div><div class="label">Wiek</div>
<div class="value" id="cardCity"></div><div class="label">Miasto</div>
<div class="value" id="cardCoupon"></div><div class="label">Kupon na darmowƒÖ ma≈Çpkƒô</div>
</div>
</div>

<div class="buttons">
<button onclick="toggleMore()">Wiƒôcej danych</button>
<button onclick="showAlkomat()">Alkomat</button>
<button onclick="drinkShot()">Zajeb ma≈Çpkƒô</button>
</div>

<div id="moreData"></div>
<div id="alkomatBox">
<h3>üç∫ Wynik alkomatu</h3>
<p><strong id="promile">0.00</strong> ‚Ä∞</p>
</div>

<div class="bottomBar">‚úÖ Dokument aktywny</div>
</div>

<script>
function q(id){return document.getElementById(id);}
let previewPhoto="";
let currentData={};
let promile=0;

q('photoFile').addEventListener('change',function(){
const file=this.files[0];
if(file){
const reader=new FileReader();
reader.onload=e=>previewPhoto=e.target.result;
reader.readAsDataURL(file);
}
});

function randomData(){
q('name').value=["Sebix","Mati","Dawcio","Kozak","Bywalec"][Math.floor(Math.random()*5)];
q('age').value=Math.floor(Math.random()*20)+18;
q('city').value=["Warszawa","Krak√≥w","Gda≈Ñsk","≈Å√≥d≈∫","Pozna≈Ñ"][Math.floor(Math.random()*5)];
q('coupon').value="MENL-"+Math.floor(Math.random()*99999);
q('shots').value=Math.floor(Math.random()*10);
q('homelessNumber').value=Math.floor(Math.random()*999);
q('renta').value=1000+Math.floor(Math.random()*4000);
}

function buildData(){
return {
photo:q('photoURL').value,
name:q('name').value,
age:q('age').value,
city:q('city').value,
coupon:q('coupon').value,
shots:Number(q('shots').value),
homelessNumber:q('homelessNumber').value,
renta:q('renta').value,
promile:promile
};
}

function generateCard(){
currentData=buildData();
q('generator').style.display="none";
q('card').style.display="block";

q('cardPhoto').src = previewPhoto || currentData.photo || "";
q('cardName').innerText=currentData.name;
q('cardAge').innerText=currentData.age;
q('cardCity').innerText=currentData.city;
q('cardCoupon').innerText=currentData.coupon;

updateMoreData();
updateAlkomat();
updateURL();
}

function toggleMore(){
q('moreData').style.display = q('moreData').style.display==="none"?"block":"none";
updateMoreData();
}

function updateMoreData(){
q('moreData').innerHTML=
"Ilo≈õƒá wypitych ma≈Çpek: "+currentData.shots+
"<br>Numer menela: "+currentData.homelessNumber+
"<br>Renta: "+currentData.renta+" z≈Ç";
}

function showAlkomat(){
q('alkomatBox').style.display=q('alkomatBox').style.display==="none"?"block":"none";
q('promile').innerText=promile.toFixed(2);
}

function drinkShot(){
currentData.shots+=1;
promile+=0.70;
q('promile').innerText=promile.toFixed(2);
updateMoreData();
updateURL();
}

function copyLink(){
if(!currentData.name) { alert("Najpierw wygeneruj kartƒô!"); return; }
const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(currentData))));
const url=location.origin+location.pathname+"?d="+encoded;
navigator.clipboard.writeText(url);
alert("Link karty skopiowany!");
}

function updateURL(){
const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(currentData))));
const url=location.origin+location.pathname+"?d="+encoded;
history.replaceState(null,"",url);
}

function loadFromURL(){
const params=new URLSearchParams(window.location.search);
const d=params.get("d");
if(d){
currentData=JSON.parse(decodeURIComponent(escape(atob(d))));
promile=currentData.promile||0;
q('generator').style.display="none";
q('card').style.display="block";
q('cardPhoto').src = currentData.photo || "";
q('cardName').innerText=currentData.name;
q('cardAge').innerText=currentData.age;
q('cardCity').innerText=currentData.city;
q('cardCoupon').innerText=currentData.coupon;
updateMoreData();
updateAlkomat();
}
}

function updateAlkomat(){
q('promile').innerText=promile.toFixed(2);
}

window.onload=loadFromURL;
</script>

</body>
</html>
